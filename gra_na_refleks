import sys
import time
import random
from PyQt6.QtWidgets import (
    QApplication, QWidget, QLabel, QPushButton, QVBoxLayout, QTextEdit
)
from PyQt6.QtCore import QTimer, Qt


class GraReakcji(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("Kliknij jak najszybciej!")

        # Lista na najlepsze czasy (maks. 10)
        self.najlepsze_wyniki = []

        # Układ pionowy
        self.layout = QVBoxLayout()

        # Etykieta z instrukcją / wynikiem
        self.label = QLabel("Kliknij START, a potem czekaj na zielone koło...")
        self.label.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.layout.addWidget(self.label)

        # Kółko (początkowo szare)
        self.kolko = QLabel()
        self.kolko.setFixedSize(100, 100)
        self.kolko.setStyleSheet("background-color: gray; border-radius: 50px;")
        self.kolko.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.layout.addWidget(self.kolko)

        # Przycisk główny
        self.button = QPushButton("START")
        self.button.clicked.connect(self.start_game)
        self.layout.addWidget(self.button)

        # Pole tekstowe do wyników
        self.wyniki_label = QLabel("Najlepsze czasy:")
        self.layout.addWidget(self.wyniki_label)

        self.wyniki_lista = QTextEdit()
        self.wyniki_lista.setReadOnly(True)
        self.layout.addWidget(self.wyniki_lista)

        self.setLayout(self.layout)

        self.timer = QTimer()
        self.timer.timeout.connect(self.show_kolko)

        self.start_time = 0
        self.zielone = False

    def start_game(self):
        self.label.setText("Czekaj na zielone koło...")
        self.kolko.setStyleSheet("background-color: gray; border-radius: 50px;")
        self.button.setText("Czekaj...")
        self.button.setEnabled(True)
        self.button.clicked.disconnect()
        self.button.clicked.connect(self.zbyt_wczesnie)

        self.zielone = False

        wait_time = random.randint(2000, 5000)
        self.timer.start(wait_time)

    def show_kolko(self):
        self.timer.stop()
        self.kolko.setStyleSheet("background-color: green; border-radius: 50px;")
        self.label.setText("KLIKNIJ TERAZ!")
        self.button.setText("KLIKNIJ!")
        self.zielone = True
        self.start_time = time.time()

        self.button.clicked.disconnect()
        self.button.clicked.connect(self.zmierz_czas)

    def zmierz_czas(self):
        if self.zielone:
            reaction_time = round((time.time() - self.start_time) * 1000)
            self.label.setText(f"Brawo! Czas reakcji: {reaction_time} ms")
            self.zapisz_wynik(reaction_time)
        else:
            self.label.setText("Zbyt wcześnie!")

        self.kolko.setStyleSheet("background-color: gray; border-radius: 50px;")
        self.button.setText("START")
        self.button.clicked.disconnect()
        self.button.clicked.connect(self.start_game)
        self.zielone = False

    def zapisz_wynik(self, czas):
        # Dodaj nowy czas
        self.najlepsze_wyniki.append(czas)
        # Sortuj rosnąco
        self.najlepsze_wyniki.sort()
        # Tylko 10 najlepszych
        self.najlepsze_wyniki = self.najlepsze_wyniki[:10]
        # Wyświetl
        self.aktualizuj_tabele()

    def aktualizuj_tabele(self):
        tekst = ""
        for i, wynik in enumerate(self.najlepsze_wyniki, start=1):
            tekst += f"{i}. {wynik} ms\n"
        self.wyniki_lista.setText(tekst)

    def zbyt_wczesnie(self):
        self.timer.stop()
        self.label.setText("Zbyt wcześnie!")
        self.kolko.setStyleSheet("background-color: red; border-radius: 50px;")
        self.button.setText("START")
        self.button.clicked.disconnect()
        self.button.clicked.connect(self.start_game)


if __name__ == "__main__":
    app = QApplication(sys.argv)
    okno = GraReakcji()
    okno.show()
    sys.exit(app.exec())
